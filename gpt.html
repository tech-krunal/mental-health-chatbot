<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üåø Real-Time Ecosystem Simulator</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Outfit', sans-serif;
      background: linear-gradient(to right, #e0f7fa, #e8f5e9);
      color: #2e2e2e;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 960px;
      margin: 40px auto;
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #1b5e20;
      font-size: 2.5rem;
    }
    canvas {
      margin-top: 20px;
    }
    .stats, .commentary {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
    }
    .stats {
      background: #f1f8e9;
      border-left: 6px solid #558b2f;
    }
    .commentary {
      background: #fff3e0;
      border-left: 6px solid #ef6c00;
      font-style: italic;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }
    button {
      padding: 12px 20px;
      font-size: 1rem;
      background-color: #43a047;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background-color: #2e7d32;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåø Real-Time Ecosystem Simulator</h1>
    <canvas id="ecoChart" height="120"></canvas>
    <div id="stats" class="stats"></div>
    <div id="commentary" class="commentary">Loading ecosystem commentary...</div>
    <div class="controls">
      <button onclick="startSimulation()">‚ñ∂Ô∏è Start</button>
      <button onclick="pauseSimulation()">‚è∏Ô∏è Pause</button>
    </div>
  </div>

  <script>
    let running = false;
    let interval;
    let cycle = 0;
    let totalResources = 500;

    let speciesList = [
      { name: 'Rabbits', population: 100, growth: 1.2, consumption: 2, color: '#81c784', data: [] },
      { name: 'Foxes', population: 30, growth: 1.05, consumption: 3, color: '#ff8a65', data: [] },
      { name: 'Deer', population: 50, growth: 1.1, consumption: 4, color: '#4db6ac', data: [] },
    ];

    const ctx = document.getElementById('ecoChart').getContext('2d');
    const ecoChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: speciesList.map(s => ({
          label: s.name,
          data: s.data,
          borderColor: s.color,
          backgroundColor: s.color + '33',
          tension: 0.3
        }))
      },
      options: {
        responsive: true,
        animation: false,
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Population'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Cycle'
            }
          }
        }
      }
    });

    function updateChart() {
      ecoChart.data.labels.push(`C${cycle}`);
      ecoChart.data.datasets.forEach((dataset, i) => {
        dataset.data.push(speciesList[i].population);
      });
      ecoChart.update();
    }

    async function simulateCycle() {
      cycle++;
      // Growth
      speciesList.forEach(s => s.population = Math.floor(s.population * s.growth));

      // Consumption
      let shuffled = [...speciesList].sort(() => 0.5 - Math.random());
      shuffled.forEach(s => {
        let needed = s.population * s.consumption;
        let consumed = Math.min(totalResources, needed);
        if (consumed < needed) {
          s.population = Math.floor(s.population * (consumed / needed));
        }
        totalResources -= consumed;
      });

      // Regenerate
      totalResources += Math.floor(Math.random() * 100 + 50);

      // Update stats
      document.getElementById('stats').innerHTML = `
        <strong>Cycle:</strong> ${cycle} <br>
        <strong>Resources:</strong> ${totalResources} <br>
        ${speciesList.map(s => `${s.name}: ${s.population}`).join('<br>')}
      `;

      // Update chart
      updateChart();

      // Gemini Commentary using fetch
      const API_KEY = 'AIzaSyDSYsFof0jjv3E7XS6lwAlR0EpD8lxLxxY'; // Replace with your Gemini API Key
      const promptText = `Provide a short, insightful ecological commentary on the following virtual ecosystem:\n\nCycle: ${cycle}\nResources: ${totalResources}\n${speciesList.map(s => `${s.name}: ${s.population}`).join("\n")}`;

      try {
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [
                {
                  parts: [ { text: promptText } ]
                }
              ]
            })
          }
        );
        const data = await response.json();
        const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "(No response)";
        document.getElementById('commentary').innerText = `ü§ñ Gemini Insight: ${text}`;
      } catch (e) {
        document.getElementById('commentary').innerText = `‚ö†Ô∏è Gemini error: ${e.message}`;
      }
    }

    window.startSimulation = function () {
      if (!running) {
        running = true;
        interval = setInterval(simulateCycle, 3000);
      }
    }

    window.pauseSimulation = function () {
      running = false;
      clearInterval(interval);
    }

    simulateCycle(); // Initial run
  </script>
</body>
</html>